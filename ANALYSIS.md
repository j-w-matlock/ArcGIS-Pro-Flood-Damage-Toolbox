# Agricultural Flood Damage Toolbox Review

This review evaluates the agricultural flood damage estimation toolbox from the perspective of agricultural economics and risk analysis. It focuses on mathematical rigor, agronomic realism, and transparency of assumptions. Line references correspond to `AgFloodDamageEstimator.pyt`.

## Summary of Key Concerns

1. **Damage fractions imply total loss at zero depth.** The default depth-damage curve is `0:1,1:1`, which forces full loss as soon as any flooding occurs (lines 115-119, 517-523). That assumption is not agronomically defensible for all crops or stages of growth. Many perennial and annual crops exhibit partial losses for shallow inundation, especially when floods are brief. At a minimum, the default curve should begin at `0:0` with a convex progression that reflects crop-specific sensitivity.
2. **Crop-value uncertainty handled as multiplicative noise despite UI specifying absolute dollars.** The user-facing description for `value_stddev` states the parameter is a standard deviation in USD/acre (lines 362-371), yet the Monte Carlo perturbation multiplies values by `1 + Normal(0, sd)` (lines 637-640). This treats the input as a *relative* standard deviation. For example, entering `200` (USD/acre) would be interpreted as a 20,000% coefficient of variation for a $1,000 crop. The implementation and documentation need to agree—either divide the sampled noise by the crop value to obtain an absolute deviation or relabel the control as a coefficient of variation.
3. **Cell area computation assumes uniform meter conversion.** Cell area in acres is derived by multiplying cell dimensions by `metersPerUnit^2` (lines 503-510). This only holds if the raster is in a projected coordinate system where metersPerUnit is constant. In geographic coordinate systems (degrees), the conversion depends on latitude; using a single conversion factor can misstate acreage and, therefore, damage totals. A robust implementation should verify projected units or compute local scale factors.
4. **Reprojection uses nearest-neighbor resampling for continuous depth.** Depth rasters are reprojected with the `NEAREST` option (lines 545-551). Nearest-neighbor resampling introduces stair-step artifacts in continuous surfaces and can bias inundation depth. Bilinear or cubic resampling is more appropriate for hydraulic depth data.
5. **Randomized flood timing ignores agronomic carryover outside growing months.** When a simulated flood month is outside the specified growing months, the algorithm zeros all damages for that run (lines 606-616). While crop loss may be smaller off-season, inundation can still damage soil, infrastructure, or perennial crops. At least a reduced damage factor—or separate dormant-season curves—should be considered instead of forcing zero.
6. **Season probability normalization disregards missing or zero-month seasons.** Season selection weights are normalized even if the associated month lists are empty (lines 526-535, 594-601). When a season has no defined months, it should be excluded from sampling to avoid fallback to random months that bypass the intended growing-season logic.
7. **Monte Carlo depth perturbations are spatially independent.** Depth uncertainty is simulated by adding independent normal noise to each pixel (lines 623-628). Hydraulic modeling errors are typically spatially correlated; independent noise exaggerates variability for large fields. Consider modeling depth uncertainty at the event level or via spatial covariance.
8. **Expected Annual Damage (EAD) assumes independent events with simple 1/RP weighting.** The discrete EAD calculation sums `Damage/RP` across events (lines 673-679). This treats each scenario as mutually exclusive and implicitly assumes a Poisson occurrence with mean 1/RP. If events represent alternative hydraulic simulations of the same river (e.g., 10-, 50-, 100-year floods), the formulation is standard, but mixing return periods from different sources could double-count risk. Documentation should clarify the assumption and recommend grouping events by watershed.
9. **Lack of provenance for crop values.** The hard-coded `CROP_DEFINITIONS` table provides per-acre values without citing sources or years (lines 9-100). Agricultural economists need the valuation basis (year, price, yield, region) to assess validity and update for inflation or market changes.

## Opportunities for Improvement

- **Document crop value sources and provide update scripts.** Include metadata describing data vintage and guidance for updating prices using USDA NASS or regional enterprise budgets.
- **Offer crop-specific default curves.** Engage agronomists to provide typical depth-damage relationships by growth stage, and let the UI surface seasonally varying curves.
- **Distinguish between production and infrastructure damages.** Allow separate loss categories for crop yield, soil remediation, and capital assets, each with appropriate seasonal sensitivity.
- **Incorporate exposure duration.** Flood duration strongly influences agricultural loss. If duration rasters are unavailable, enable user-supplied multipliers by crop and season.
- **Add validation and sensitivity reporting.** Provide automated summaries of how much variance each uncertainty input contributes to overall damage (e.g., tornado charts) to aid decision makers.
- **Ensure reproducibility of Monte Carlo draws.** While a Python `Random` seed is used (lines 493-498, 618-621), the conversion to NumPy RNG seeds could be logged to confirm repeatability.

Implementing these recommendations will help the toolbox withstand scrutiny from agricultural economists by clarifying assumptions, aligning parameter semantics with implementation, and grounding calculations in agronomic realities.
